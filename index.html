<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <title>Two Truths and a Lie</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Side Menu -->
    <div id="side-menu" class="side-menu">
        <div class="side-menu-header">
            <h3>Settings</h3>
            <button id="close-menu" class="close-menu-btn">&times;</button>
        </div>
        <div class="side-menu-content">
            <div class="menu-section">
                <h4>Language</h4>
                <div class="menu-options">
                    <button id="lang-en" class="menu-option active">English</button>
                    <button id="lang-vi" class="menu-option">Ti·∫øng Vi·ªát</button>
                </div>
            </div>
            <div class="menu-section">
                <h4>Theme</h4>
                <div class="menu-options">
                    <button id="theme-toggle" class="menu-option">Dark Mode</button>
                </div>
            </div>
            <div class="menu-section">
                <h4>Data</h4>
                <div class="menu-options">
                    <button id="clear-data" class="menu-option">Clear Saved Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Menu Button -->
    <button id="menu-btn" class="menu-btn">‚ò∞</button>
    
    <!-- Menu Overlay -->
    <div id="menu-overlay" class="menu-overlay"></div>

    <div id="welcome-popup">
        <div class="popup-content">
        <p class="quote">"This game helps you get to know each other deeply through personal topics and surprising truths hidden among made-up stories. Have fun!"<br><span class="quote-author">- Duong Tung Nguyen</span></p>
        <p id="countdown" class="countdown"></p>
        </div>
    </div>
    <div id="app">
        <div id="welcome-screen">
            <h1 id="main-title">Two Truths and a Lie</h1>
            
            <div class="game-instructions">
                <h3 id="instructions-title">How to Play:</h3>
                <div id="instructions-content">
                    <ol>
                        <li>Two players join the same room</li>
                        <li>Each player takes turns creating 3 statements about themselves</li>
                        <li>2 statements are lies, 1 statement is the truth</li>
                        <li>Mark which statement is TRUE using the check icon</li>
                        <li>The other player tries to guess which one is the truth</li>
                        <li>Score points for correct guesses!</li>
                        <li>Play 5 rounds and see who wins!</li>
                    </ol>
                </div>
            </div>
            
            <div class="game-mode-selection">
                <h3 id="mode-selection-title">Choose Game Mode:</h3>
                <div class="mode-grid">
                    <div class="mode-card active" data-mode="two-truths">
                        <div class="mode-icon">üéØ</div>
                        <h4>Two Truths & a Lie</h4>
                        <p>Classic game - guess which statement is true</p>
                    </div>
                    <div class="mode-card" data-mode="story-building">
                        <div class="mode-icon">üìö</div>
                        <h4>Story Building Challenge</h4>
                        <p>Collaborate to create an amazing story together</p>
                    </div>
                    <div class="mode-card" data-mode="would-you-rather">
                        <div class="mode-icon">ü§î</div>
                        <h4>Would You Rather: Extreme Edition</h4>
                        <p>Make tough philosophical choices and explain your reasoning</p>
                    </div>
                    <div class="mode-card" data-mode="assumption-buster">
                        <div class="mode-icon">üí•</div>
                        <h4>Assumption Buster</h4>
                        <p>Challenge assumptions about each other and discover surprising truths</p>
                    </div>
                </div>
            </div>

            <div class="game-settings">
                <h3 id="settings-title">Game Settings:</h3>
                <div class="setting-group">
                    <label for="round-count" id="rounds-label">Number of Rounds:</label>
                    <select id="round-count">
                        <option value="3">3 Rounds</option>
                        <option value="5" selected>5 Rounds</option>
                        <option value="7">7 Rounds</option>
                        <option value="10">10 Rounds</option>
                    </select>
                </div>
            </div>
            
            <div class="room-section">
                <div class="input-group">
                    <input type="text" id="player-name" placeholder="Enter Your Name">
                </div>
                <div class="input-group">
                    <input type="text" id="room-name" placeholder="Enter Room Name">
                </div>
                <div class="button-group">
                    <button id="join-room">Join Room</button>
                    <button id="join-viewer">Join as Viewer</button>
                    <button id="view-history-btn">View History</button>
                </div>
            </div>
        </div>

        <div id="history-screen" class="hidden">
            <h2>Game History</h2>
            <p id="history-instructions">Click a session below to view details.</p>
            <ul id="history-list"></ul>
            <div id="session-detail" class="hidden">
                <h3>Session Details</h3>
                <ul id="detail-list"></ul>
                <button id="back-to-history">Back</button>
            </div>
            <button id="clear-history">Clear History</button>
            <button id="back-to-menu">Back to Menu</button>
        </div>

        <div id="game-screen" class="hidden">
            <div id="game-info">
                <div class="player-info">
                    <div id="player-display" class="player-badge">
                        <span id="player-number"></span>
                        <span id="player-name-display"></span>
                    </div>
                </div>
                <div id="scoreboard" class="scoreboard">
                    <div class="score-item" id="player1-score">
                        <span class="player-name" id="player1-name">Player 1</span>
                        <span class="player-score" id="player1-points">0</span>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="score-item" id="player2-score">
                        <span class="player-name" id="player2-name">Player 2</span>
                        <span class="player-score" id="player2-points">0</span>
                    </div>
                </div>
                <div class="game-controls">
                    <p id="game-status" class="status-message"></p>
                    <button id="exit-game" class="exit-btn">Exit Game</button>
                </div>
            </div>
            
            <!-- Emoji Interaction Panel -->
            <div id="emoji-interaction" class="emoji-panel hidden">
                <div class="emoji-header">
                    <h4>Quick Reactions</h4>
                    <button id="toggle-emoji-panel" class="emoji-toggle">üòÄ</button>
                </div>
                <div class="emoji-content">
                    <div class="emoji-buttons">
                        <button class="emoji-btn" data-emoji="üëç" title="Thumbs up">üëç</button>
                        <button class="emoji-btn" data-emoji="üòÇ" title="Laughing">üòÇ</button>
                        <button class="emoji-btn" data-emoji="üòÆ" title="Surprised">üòÆ</button>
                        <button class="emoji-btn" data-emoji="ü§î" title="Thinking">ü§î</button>
                        <button class="emoji-btn" data-emoji="üëè" title="Clapping">üëè</button>
                        <button class="emoji-btn" data-emoji="üòé" title="Cool">üòé</button>
                        <button class="emoji-btn" data-emoji="üôÑ" title="Eye roll">üôÑ</button>
                        <button class="emoji-btn" data-emoji="‚ù§Ô∏è" title="Love">‚ù§Ô∏è</button>
                    </div>
                    <div id="emoji-messages" class="emoji-messages"></div>
                </div>
            </div>
            <h2 id="round-title"></h2>
            
            <div id="topic-selection-area" class="hidden">
                <p id="topic-prompt"></p>
                <div id="topic-grid" class="topic-grid"></div>
                <div id="custom-topic-section" class="custom-topic-section hidden">
                    <h4 id="custom-topic-title">Create Custom Topic</h4>
                    <div class="custom-topic-input-group">
                        <input type="text" id="custom-topic-name" placeholder="Topic name (e.g., 'My Dreams')" maxlength="50">
                        <textarea id="custom-topic-description" placeholder="Brief description (optional)" maxlength="100" rows="2"></textarea>
                        <textarea id="custom-topic-suggestions" placeholder="Add example statements (optional - one per line)" rows="3"></textarea>
                        <div class="custom-topic-options">
                            <label class="point-value-label">
                                <span>Point Value:</span>
                                <select id="custom-topic-points">
                                    <option value="1">1 point (Easy)</option>
                                    <option value="2">2 points (Moderate)</option>
                                    <option value="3">3 points (Sensitive)</option>
                                    <option value="4">4 points (Deep)</option>
                                    <option value="5">5 points (Challenging)</option>
                                </select>
                            </label>
                        </div>
                        <div class="custom-topic-actions">
                            <button id="create-custom-topic" class="create-topic-btn">Create Custom Topic</button>
                            <button id="cancel-custom-topic" class="cancel-topic-btn">Cancel</button>
                        </div>
                    </div>
                </div>
                <div id="topic-suggestions" class="topic-suggestions hidden">
                    <h4 id="suggestions-title">Suggested answers for <span id="current-topic-name"></span>:</h4>
                    <ul id="suggestion-list"></ul>
                    <button id="select-current-topic" class="hidden">Select This Topic</button>
                </div>
                <div id="selected-topics">
                    <h4 id="selected-topics-title">Selected Topics:</h4>
                    <div id="selected-topic-list"></div>
                    <button id="confirm-topics" class="hidden">Confirm Topic Selection</button>
                </div>
            </div>
            
            <div id="input-area">
                <p id="input-prompt"></p>
                <div id="current-topic" class="current-topic hidden">
                    <h4>Your Topic: <span id="topic-display"></span></h4>
                    <button id="see-topic-btn" class="see-topic-btn">See Topic Suggestions</button>
                </div>
                <div id="topic-help" class="topic-suggestions hidden">
                    <h4>Suggestions for <span id="help-topic-name"></span>:</h4>
                    <ul id="help-suggestion-list"></ul>
                    <button id="hide-topic-help" class="hide-help-btn">Hide Suggestions</button>
                </div>
                <div class="statement-input-group">
                    <input type="text" id="statement1" placeholder="Statement 1">
                    <label class="radio-label" title="Mark as truth">
                        <input type="radio" name="truth-selection" value="0" id="radio-1">
                        <span class="radio-icon">&#10004;</span>
                    </label>
                </div>
                <div class="statement-input-group">
                    <input type="text" id="statement2" placeholder="Statement 2">
                    <label class="radio-label" title="Mark as truth">
                        <input type="radio" name="truth-selection" value="1" id="radio-2">
                        <span class="radio-icon">&#10004;</span>
                    </label>
                </div>
                <div class="statement-input-group">
                    <input type="text" id="statement3" placeholder="Statement 3">
                    <label class="radio-label" title="Mark as truth">
                        <input type="radio" name="truth-selection" value="2" id="radio-3">
                        <span class="radio-icon">&#10004;</span>
                    </label>
                </div>
                <button id="submit-statements">Submit</button>
            </div>
            <div id="guess-area" class="hidden">
                <p id="guess-prompt"></p>
                <div id="opponent-topic" class="current-topic hidden">
                    <h4>Topic: <span id="opponent-topic-display"></span></h4>
                </div>
                <button class="statement-btn" id="statement-btn-1"></button>
                <button class="statement-btn" id="statement-btn-2"></button>
                <button class="statement-btn" id="statement-btn-3"></button>
            </div>
            
            <!-- Story Building Challenge Area -->
            <div id="story-building-area" class="hidden">
                <div class="story-header">
                    <h3 id="story-title">Our Story</h3>
                    <div class="story-progress">
                        <span id="story-turn-indicator">Player 1's Turn</span>
                        <div class="story-counter">Turn <span id="turn-counter">1</span> of <span id="max-turns">10</span></div>
                    </div>
                </div>
                
                <div class="story-display">
                    <div id="story-text" class="story-content">
                        <p class="story-starter">Once upon a time...</p>
                    </div>
                </div>
                
                <div id="random-element" class="random-element hidden">
                    <div class="random-element-header">
                        <span class="random-icon">üé≤</span>
                        <span>Include this element:</span>
                    </div>
                    <div id="random-element-text" class="random-element-content"></div>
                </div>
                
                <div class="story-input">
                    <textarea id="story-input-text" placeholder="Add 2-3 sentences to continue the story..." maxlength="200" rows="3"></textarea>
                    <div class="story-input-controls">
                        <div class="character-count">
                            <span id="char-count">0</span>/200 characters
                        </div>
                        <button id="submit-story-part" class="story-submit-btn">Add to Story</button>
                    </div>
                </div>
            </div>
            
            <!-- Assumption Buster Area -->
            <div id="assumption-buster-area" class="hidden">
                <div class="ab-header">
                    <h3 id="ab-title">Assumption Buster</h3>
                    <div class="ab-progress">
                        <span id="ab-round-indicator">Round 1</span>
                        <div class="ab-phase">Phase: <span id="ab-phase-indicator">Making Assumptions</span></div>
                    </div>
                </div>
                
                <div id="ab-make-assumption" class="ab-phase-area">
                    <div class="assumption-prompt">
                        <h4>Make an assumption about <span id="ab-target-player">the other player</span>:</h4>
                        <p class="assumption-hint">Think about their personality, preferences, or experiences. What do you assume to be true about them?</p>
                    </div>
                    <div class="assumption-templates">
                        <h5>Quick templates (optional):</h5>
                        <div class="template-buttons">
                            <button class="template-btn" data-template="I think you prefer [A] over [B]">Preferences</button>
                            <button class="template-btn" data-template="I assume you have [experience/trait]">Experiences</button>
                            <button class="template-btn" data-template="I believe you would [action] in [situation]">Behavior</button>
                            <button class="template-btn" data-template="I think your personality is more [trait] than [trait]">Personality</button>
                        </div>
                    </div>
                    <textarea id="ab-assumption-input" placeholder="Write your assumption here..." maxlength="200" rows="3"></textarea>
                    <div class="ab-input-controls">
                        <div class="char-count">Character count: <span id="ab-assumption-char-count">0</span>/200</div>
                        <button id="submit-assumption" class="ab-submit-btn">Submit Assumption</button>
                    </div>
                </div>
                
                <div id="ab-respond-assumption" class="ab-phase-area hidden">
                    <div class="assumption-display">
                        <h4>Assumption about you:</h4>
                        <p id="assumption-text">Loading assumption...</p>
                    </div>
                    
                    <div class="ab-responses">
                        <h5>Is this assumption correct?</h5>
                        <div class="response-options">
                            <button id="response-true" class="ab-response-btn response-true">
                                <span class="response-icon">‚úì</span>
                                <span class="response-label">True</span>
                            </button>
                            <button id="response-false" class="ab-response-btn response-false">
                                <span class="response-icon">‚úó</span>
                                <span class="response-label">False</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="ab-explanation-area" class="ab-explanation hidden">
                    <h4>Explain your response:</h4>
                    <p class="explanation-prompt">Why is this assumption true or false? Share the story behind it!</p>
                    <textarea id="ab-explanation-input" placeholder="Tell us more about why this assumption is correct or incorrect..." maxlength="300" rows="3"></textarea>
                    <div class="ab-explanation-controls">
                        <div class="char-count">Character count: <span id="ab-char-count">0</span>/300</div>
                        <button id="submit-ab-explanation" class="ab-submit-btn">Submit Explanation</button>
                    </div>
                </div>
                
                <div id="ab-results-area" class="ab-results hidden">
                    <h4>Results & Revelations</h4>
                    <div id="ab-player-results">
                        <!-- Player results will be populated here dynamically -->
                    </div>
                    <div class="ab-scoring">
                        <div id="ab-surprise-scores">
                            <h5>Surprise Points Awarded:</h5>
                            <div class="score-breakdown">
                                <span id="ab-player1-points">Player 1: +0 pts</span>
                                <span id="ab-player2-points">Player 2: +0 pts</span>
                            </div>
                        </div>
                    </div>
                    <div class="ab-next-round">
                        <button id="ab-next-round" class="ab-next-btn">Next Round</button>
                    </div>
                </div>
            </div>
            
            <!-- Would You Rather Area -->
            <div id="would-you-rather-area" class="hidden">
                <div class="wyr-header">
                    <h3 id="wyr-title">Would You Rather...</h3>
                    <div class="wyr-progress">
                        <span id="wyr-round-indicator">Round 1</span>
                        <div class="wyr-timer">Time to decide: <span id="wyr-timer">30</span>s</div>
                    </div>
                </div>
                
                <div class="wyr-question-display">
                    <div id="wyr-question" class="wyr-question">
                        <p id="wyr-question-text">Loading question...</p>
                        <div class="wyr-difficulty">
                            <span id="wyr-category">Category</span>
                            <span id="wyr-difficulty-level">Difficulty: Hard</span>
                        </div>
                    </div>
                </div>
                
                <div class="wyr-choices">
                    <button id="wyr-choice-a" class="wyr-choice-btn">
                        <div class="choice-letter">A</div>
                        <div class="choice-text">Option A</div>
                    </button>
                    <button id="wyr-choice-b" class="wyr-choice-btn">
                        <div class="choice-letter">B</div>
                        <div class="choice-text">Option B</div>
                    </button>
                </div>
                
                <div id="wyr-explanation-area" class="wyr-explanation hidden">
                    <h4>Explain your choice:</h4>
                    <textarea id="wyr-explanation-input" placeholder="Why did you choose this option? Share your reasoning..." maxlength="300" rows="3"></textarea>
                    <div class="wyr-explanation-controls">
                        <div class="char-count">Character count: <span id="wyr-char-count">0</span>/300</div>
                        <button id="submit-wyr-explanation" class="wyr-submit-btn">Submit Explanation</button>
                    </div>
                </div>
                
                <div id="wyr-results-area" class="wyr-results hidden">
                    <h4>Results & Explanations</h4>
                    <div id="wyr-player-results">
                        <div class="wyr-player-result" id="wyr-player1-result">
                            <div class="result-header">
                                <span class="player-name">Player 1</span>
                                <span class="player-choice">Choice A</span>
                            </div>
                            <div class="result-explanation">Player 1's explanation...</div>
                        </div>
                        <div class="wyr-player-result" id="wyr-player2-result">
                            <div class="result-header">
                                <span class="player-name">Player 2</span>
                                <span class="player-choice">Choice B</span>
                            </div>
                            <div class="result-explanation">Player 2's explanation...</div>
                        </div>
                    </div>
                    <div class="wyr-scoring">
                        <div id="wyr-thoughtfulness-scores">
                            <h5>Thoughtfulness Points Awarded:</h5>
                            <div class="score-breakdown">
                                <span id="wyr-player1-points">Player 1: +0 pts</span>
                                <span id="wyr-player2-points">Player 2: +0 pts</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <p id="result-message"></p>
            <button id="next-round" class="hidden">Next Round</button>
        </div>

        <div id="end-screen" class="hidden">
            <h2>Game Over!</h2>
            <p id="final-score"></p>
            <p id="winner"></p>
            <button id="play-again">Play Again</button>
            <button id="exit-final" class="exit-btn">Exit to Menu</button>
        </div>
    </div>
    
    <!-- Custom Topic Approval Popup -->
    <div id="custom-topic-approval-popup" class="popup-overlay hidden">
        <div class="popup-content">
            <h3 id="approval-popup-title">Custom Topic Approval</h3>
            <p id="approval-popup-message">Another player wants to create a custom topic:</p>
            <div class="custom-topic-preview">
                <div class="topic-preview-item">
                    <strong>Topic:</strong> <span id="preview-topic-title"></span>
                </div>
                <div class="topic-preview-item">
                    <strong>Description:</strong> <span id="preview-topic-description"></span>
                </div>
                <div class="topic-preview-item">
                    <strong>Suggestions:</strong>
                    <ul id="preview-topic-suggestions"></ul>
                </div>
            </div>
            <div class="popup-buttons">
                <button id="approve-custom-topic" class="approve-btn">Approve</button>
                <button id="reject-custom-topic" class="reject-btn">Reject</button>
            </div>
        </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>
